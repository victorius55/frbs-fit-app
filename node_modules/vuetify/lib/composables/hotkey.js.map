{"version":3,"file":"hotkey.js","names":["onBeforeUnmount","toValue","watch","IN_BROWSER","getCurrentInstance","useHotkey","keys","callback","options","arguments","length","undefined","event","inputs","preventDefault","sequenceTimeout","isMac","navigator","userAgent","includes","timeout","keyGroups","isSequence","groupIndex","clearTimer","clearTimeout","isInputFocused","activeElement","document","tagName","isContentEditable","contentEditable","resetSequence","handler","e","group","matchesKeyGroup","window","setTimeout","cleanup","removeEventListener","splitKeySequence","str","groups","current","i","char","next","push","unrefKeys","toLowerCase","addEventListener","immediate","parseKeyGroup","MODIFIERS","parts","split","modifiers","Object","fromEntries","map","m","actualKey","part","lastChar","slice","ctrlKey","cmd","ctrl","metaKey","meta","shiftKey","shift","altKey","alt","key"],"sources":["../../src/composables/hotkey.ts"],"sourcesContent":["// Utilities\nimport { onBeforeUnmount, toValue, watch } from 'vue'\nimport { IN_BROWSER } from '@/util'\nimport { getCurrentInstance } from '@/util/getCurrentInstance'\n\n// Types\nimport type { MaybeRef } from '@/util'\n\ninterface HotkeyOptions {\n  event?: 'keydown' | 'keyup'\n  inputs?: boolean\n  preventDefault?: boolean\n  sequenceTimeout?: number\n}\n\nexport function useHotkey (\n  keys: MaybeRef<string | undefined>,\n  callback: (e: KeyboardEvent) => void,\n  options: HotkeyOptions = {}\n) {\n  if (!IN_BROWSER) return function () {}\n\n  const {\n    event = 'keydown',\n    inputs = false,\n    preventDefault = true,\n    sequenceTimeout = 1000,\n  } = options\n\n  const isMac = navigator?.userAgent?.includes('Macintosh')\n  let timeout = 0\n  let keyGroups: string[]\n  let isSequence = false\n  let groupIndex = 0\n\n  function clearTimer () {\n    if (!timeout) return\n\n    clearTimeout(timeout)\n    timeout = 0\n  }\n\n  function isInputFocused () {\n    if (inputs) return false\n\n    const activeElement = document.activeElement as HTMLElement\n\n    return activeElement && (\n      activeElement.tagName === 'INPUT' ||\n      activeElement.tagName === 'TEXTAREA' ||\n      activeElement.isContentEditable ||\n      activeElement.contentEditable === 'true'\n    )\n  }\n\n  function resetSequence () {\n    groupIndex = 0\n    clearTimer()\n  }\n\n  function handler (e: KeyboardEvent) {\n    const group = keyGroups[groupIndex]\n\n    if (!group || isInputFocused()) return\n\n    if (!matchesKeyGroup(e, group)) {\n      if (isSequence) resetSequence()\n      return\n    }\n\n    if (preventDefault) e.preventDefault()\n\n    if (!isSequence) {\n      callback(e)\n      return\n    }\n\n    clearTimer()\n    groupIndex++\n\n    if (groupIndex === keyGroups.length) {\n      callback(e)\n      resetSequence()\n      return\n    }\n\n    timeout = window.setTimeout(resetSequence, sequenceTimeout)\n  }\n\n  function cleanup () {\n    window.removeEventListener(event, handler)\n    clearTimer()\n  }\n\n  function splitKeySequence (str: string) {\n    const groups: string[] = []\n    let current = ''\n    for (let i = 0; i < str.length; i++) {\n      const char = str[i]\n      if (char === '-') {\n        const next = str[i + 1]\n        // Treat '-' as a sequence delimiter only if the next character exists\n        // and is NOT one of '-', '+', or '_' (these indicate the '-' belongs to the key itself)\n        if (next && !['-', '+', '_'].includes(next)) {\n          groups.push(current)\n          current = ''\n          continue\n        }\n      }\n      current += char\n    }\n    groups.push(current)\n\n    return groups\n  }\n\n  watch(() => toValue(keys), function (unrefKeys) {\n    cleanup()\n\n    if (unrefKeys) {\n      const groups = splitKeySequence(unrefKeys.toLowerCase())\n      isSequence = groups.length > 1\n      keyGroups = groups\n      resetSequence()\n      window.addEventListener(event, handler)\n    }\n  }, { immediate: true })\n\n  try {\n    getCurrentInstance('useHotkey')\n    onBeforeUnmount(cleanup)\n  } catch {\n    // Not in Vue setup context\n  }\n\n  function parseKeyGroup (group: string) {\n    const MODIFIERS = ['ctrl', 'shift', 'alt', 'meta', 'cmd']\n\n    // Split on +, -, or _ but keep empty strings which indicate consecutive separators (e.g. alt--)\n    const parts = group.toLowerCase().split(/[+_-]/)\n\n    const modifiers = Object.fromEntries(MODIFIERS.map(m => [m, false])) as Record<string, boolean>\n    let actualKey: string | undefined\n\n    for (const part of parts) {\n      if (!part) continue // Skip empty tokens\n      if (MODIFIERS.includes(part)) {\n        modifiers[part] = true\n      } else {\n        actualKey = part\n      }\n    }\n\n    // Fallback for cases where actualKey is a literal '+' or '-' (e.g. alt--, alt++ , alt+-, alt-+)\n    if (!actualKey) {\n      const lastChar = group.slice(-1)\n      if (['+', '-', '_'].includes(lastChar)) actualKey = lastChar\n    }\n\n    return { modifiers, actualKey }\n  }\n\n  function matchesKeyGroup (e: KeyboardEvent, group: string) {\n    const { modifiers, actualKey } = parseKeyGroup(group)\n\n    return (\n      e.ctrlKey === (isMac && modifiers.cmd ? false : modifiers.ctrl) &&\n      e.metaKey === (isMac && modifiers.cmd ? true : modifiers.meta) &&\n      e.shiftKey === modifiers.shift &&\n      e.altKey === modifiers.alt &&\n      e.key.toLowerCase() === actualKey?.toLowerCase()\n    )\n  }\n\n  return cleanup\n}\n"],"mappings":"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","ignoreList":[]}